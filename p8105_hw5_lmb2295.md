Homework 5
================
Laya Buchanan
2020-11-05

This is my submission for the fifth homework assignment for P8105.

# Problem 2: Longitudinal study data

First, I created a tidy dataframe containing data from all participants,
including the subject ID, arm, and observations over time from the
original folder of .csv files.

``` r
control_exp_df = 
  map_df(list.files(path = "./data", full.names = TRUE), read.csv) %>% 
  mutate(file_name = list.files(path = "./data")) %>% 
  relocate(file_name, .before = week_1) %>% 
  separate(file_name, into = c("arm", "id"), sep = "_") %>% 
  separate(id, into = c("id", "delete"), sep = "\\.") %>% 
  select(-delete) %>% 
  mutate(arm = recode(arm, 'con' = "control")) %>% 
  mutate(arm = recode(arm, 'exp' = "experimental"))
```

Then, I made a spaghetti plot showing observations on each subject over
time by week.

``` r
control_exp_df %>% 
  pivot_longer(
    week_1:week_8,
    names_to = "week",
    names_prefix = "week_",
    values_to = "value"
    ) %>% 
  unite(group, arm:id, sep = '', remove = FALSE) %>% 
  ggplot(aes(x = week, y = value, group = group, color = arm)) + 
  geom_line() + 
  labs(
    title = "Measurement for Control vs Experimental Arm Over Time",
    x = "Week",
    y = "Value") +
   theme(legend.position = "right")
```

<img src="p8105_hw5_lmb2295_files/figure-gfm/unnamed-chunk-3-1.png" width="90%" />

While measurements for the variable of interests were comparable at
baseline for the control and experimental groups, values increased over
time for the experimental group, but not for the control group. There
was considerable inter- and intra-individual variability in both groups.

# Problem 3: Power

``` r
sim_t_test = function(n = 30, mu, sigma = 5) {
  
  sim_data = tibble(
    x = rnorm(n, mean = mu, sd = sigma)
  )
  
    sim_data %>% 
      t.test(
      mu = 0,
      conf.level = 0.95) %>% 
      tidy()
  

}
```

``` r
output = vector("list", length = 100)

for (i in 1:100) {
  
  output[[i]] = sim_t_test(mu = 0)
  
}

bind_rows(output)
```

    ## # A tibble: 100 x 8
    ##    estimate statistic p.value parameter conf.low conf.high method    alternative
    ##       <dbl>     <dbl>   <dbl>     <dbl>    <dbl>     <dbl> <chr>     <chr>      
    ##  1   -0.543    -0.724  0.475         29   -2.08      0.992 One Samp~ two.sided  
    ##  2    1.01      1.17   0.253         29   -0.763     2.79  One Samp~ two.sided  
    ##  3   -0.165    -0.167  0.868         29   -2.19      1.85  One Samp~ two.sided  
    ##  4   -0.621    -0.587  0.562         29   -2.79      1.54  One Samp~ two.sided  
    ##  5    1.28      1.34   0.190         29   -0.673     3.23  One Samp~ two.sided  
    ##  6   -1.54     -1.60   0.119         29   -3.50      0.422 One Samp~ two.sided  
    ##  7   -0.809    -1.05   0.302         29   -2.38      0.765 One Samp~ two.sided  
    ##  8   -1.33     -1.79   0.0837        29   -2.84      0.188 One Samp~ two.sided  
    ##  9   -0.140    -0.176  0.861         29   -1.76      1.48  One Samp~ two.sided  
    ## 10    0.933     1.13   0.269         29   -0.762     2.63  One Samp~ two.sided  
    ## # ... with 90 more rows

``` r
mu_list = 
  list(
    "mu = 0" = 0,
    "mu = 1" = 1,
    "mu = 2" = 2,
    "mu = 3" = 3,
    "mu = 4" = 4,
    "mu = 5" = 5,
    "mu = 6" = 6
  )

for (i in 1:7) {
  output[[i]] = 
    rerun(100, sim_t_test(mu = mu_list[[i]]))
bind_rows()
}


tibble(
  mu = c(0, 1, 2, 3, 4, 5, 6)
) %>% 
  mutate(
    output_lists = map(.x = mu, ~rerun(100, sim_t_test(mu = .x))), 
estimate_df = map(output_lists, bind_rows
  )
) %>% 
  unnest(estimate_df) %>% 
  select(mu, estimate, p.value)
```

    ## # A tibble: 700 x 3
    ##       mu estimate p.value
    ##    <dbl>    <dbl>   <dbl>
    ##  1     0  0.960    0.360 
    ##  2     0  1.68     0.125 
    ##  3     0 -0.550    0.612 
    ##  4     0 -1.40     0.136 
    ##  5     0 -1.05     0.324 
    ##  6     0 -0.665    0.534 
    ##  7     0  0.238    0.756 
    ##  8     0  0.308    0.696 
    ##  9     0 -1.58     0.0846
    ## 10     0 -0.00649  0.995 
    ## # ... with 690 more rows
